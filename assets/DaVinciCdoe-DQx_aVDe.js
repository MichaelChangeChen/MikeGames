import{u as na,a as da,r as _,j as ca,k as va,_ as O,c as A,d as U,f as v,o as N,l as ra,b as l,t as y,n as H,g as D,w as F,h as ua}from"./index-C6qp-Gu2.js";import{r as ha,g as ma,a as ba,s as fa}from"./getApi-ZjIo6tCc.js";const xa=()=>{const h=na(),f=da(),g=_(500),c=_(null),m=_(null),M=_({}),x=_(null),p=_(null),C=_(null),R=15,o=g.value/2,S=.3,V=.98,I=.9;let E=null,u=null,P=0,q=0,$=0,n=[];class J{constructor(a,t,e,i){this.x=a,this.y=t,this.vx=0,this.vy=0,this.radius=e,this.color=`hsl(${(Math.random()-1)*Math.random()*360}, 75%, 70%)`,this.id=i}draw(a){a.beginPath(),a.arc(this.x,this.y,this.radius,0,Math.PI*2),a.fillStyle=this.color,a.fill(),a.fillStyle="white",a.font="12px serif",a.textAlign="center",a.textBaseline="middle",a.fillText(this.id,this.x,this.y)}update(){if(this.id===(u==null?void 0:u.id))return this.vy=0;this.vy+=S,this.vy*=V,this.x+=this.vx,this.y+=this.vy,Math.abs(this.vx)<.01&&(this.vx=0),Math.abs(this.vy)<.01&&(this.vy=0)}resolveBoundary(){const a=this.x-o,t=this.y-o,e=Math.sqrt(a*a+t*t),i=o-this.radius;if(e>i){const d=Math.atan2(t,a);this.x=o+i*Math.cos(d),this.y=o+i*Math.sin(d);const r=a/e,b=t/e,k=this.vx*r+this.vy*b;this.vx-=2*k*r*I,this.vy-=2*k*b*I}}resolveCollision(a){const t=a.x-this.x,e=a.y-this.y,i=Math.hypot(t,e),d=this.radius+a.radius;if(i<d&&i>0){const r=t/i,b=e/i,k=d-i;this.x-=r*k*.5,this.y-=b*k*.5,a.x+=r*k*.5,a.y+=b*k*.5;const w=-b,B=r,G=this.vx*w+this.vy*B,X=a.vx*w+a.vy*B,Y=this.vx*r+this.vy*b,j=a.vx*r+a.vy*b;this.vx=w*G+r*j,this.vy=B*G+b*j,a.vx=w*X+r*Y,a.vy=B*X+b*Y}}}const L=()=>{ha().then(s=>{s.data.statusCode===1?($=s.data.max_num,m.value=s.data.guess_time,p.value=s.data.tips,M.value=s.data.best_time,x.value.check(s.data.message),Z()):console.log("連線出現問題~")}).catch(s=>{console.log(s)})},K=()=>{ma().then(s=>{s.data.statusCode===1?console.log(s.data):console.log("連線出現問題~")}).catch(s=>{console.log(s)})},Q=()=>{let s={name:C.value,guess_time:m.value};fa(s).then(a=>{a.data.statusCode===1?console.log(2424):console.log("連線出現問題~")}).catch(a=>{console.log(a)})},W=async s=>{ba({guess:s}).then(a=>{a.data.statusCode===1?(a.data.status==="safe"?n=n.filter(t=>t.id<a.data.max_num&&a.data.min_num<t.id):a.data.status==="boom"&&(Q(),n=[]),x.value.check(a.data.message),p.value=a.data.tips,m.value=a.data.guess_time):console.log("連線出現問題~")}).catch(a=>{console.log(a)})},Z=async()=>{n=[];for(let s=0;s<$;s++)await sa(s),await aa(15)},aa=s=>new Promise(a=>setTimeout(a,s)),sa=s=>{const a=Math.random()*Math.PI+Math.PI,t=(Math.random()*.3+.4)*(o-R),e=o+Math.cos(a)*t,i=o+Math.sin(a)*t;n.push(new J(e,i,R,s+1))},z=()=>{const s=c.value;if(!s)return;const a=s.getContext("2d");a.clearRect(0,0,s.width,s.height),a.beginPath(),a.arc(o,o,o-1,0,Math.PI*2),a.strokeStyle="#999",a.stroke(),a.fillStyle="white",a.fill(),n.forEach(t=>t.update());for(let t=0;t<12;t++)for(let e=0;e<n.length;e++){for(let i=e+1;i<n.length;i++)n[e].resolveCollision(n[i]);n[e].resolveBoundary()}n.forEach(t=>t.draw(a)),E=requestAnimationFrame(z)},ta=s=>{W(s)},T=s=>{const a=c.value.getBoundingClientRect();return{x:s.clientX-a.left,y:s.clientY-a.top}},ea=s=>{const{x:a,y:t}=T(s);let e=!1;for(const i of n){const d=a-i.x,r=t-i.y;if(Math.sqrt(d*d+r*r)<=i.radius){e=!0;break}}c.value.style.cursor=u?"grabbing":e?"pointer":"default",u&&(u.x=a-P,u.y=t-q,u.vx=0,u.vy=0)},ia=s=>{const{x:a,y:t}=T(s);for(const e of n){const i=a-e.x,d=t-e.y;if(Math.sqrt(i*i+d*d)<=e.radius){P=i,q=d,u=e;break}}},oa=()=>{u&&(u=null)},la=s=>{const{x:a,y:t}=T(s);for(const e of n){const i=a-e.x,d=t-e.y;if(Math.sqrt(i*i+d*d)<=e.radius){ta(e.id);break}}};return ca(()=>{if(!h.getData)return f.push("/");C.value=h.getData,z(),L(),K(),c.value.addEventListener("mousemove",ea),c.value.addEventListener("mousedown",ia),c.value.addEventListener("mouseup",oa),c.value.addEventListener("dblclick",la)}),va(()=>{E&&cancelAnimationFrame(E)}),{daVinciCdoeAnimate:x,canvasSize:g,canvasRef:c,guessTime:m,playerName:C,bestScroe:M,tips:p,reset:L}},ya=()=>{const h=_(!1),f=_(null);return{open:h,check:c=>{f.value=c,h.value=!h.value,setTimeout(()=>{h.value=!h.value,f.value=null},1800)},message:f}},_a={key:0,class:"da-vinci-cdoe-animate"},ga={__name:"DaVinciCdoeAnimate",setup(h,{expose:f}){const{open:g,check:c,message:m}=ya();return f({check:c}),(M,x)=>v(g)?(N(),A("div",_a,[x[0]||(x[0]=ra('<div class="block-track" data-v-a0166b3a><div class="block-box" data-v-a0166b3a><div class="block" data-v-a0166b3a></div><div class="block next" data-v-a0166b3a></div><div class="block" data-v-a0166b3a></div><div class="block next" data-v-a0166b3a></div></div><div class="block" data-v-a0166b3a></div><div class="block next" data-v-a0166b3a></div><div class="block-box" data-v-a0166b3a><div class="block" data-v-a0166b3a></div><div class="block next" data-v-a0166b3a></div><div class="block" data-v-a0166b3a></div><div class="block next" data-v-a0166b3a></div></div><div class="block" data-v-a0166b3a></div><div class="block next" data-v-a0166b3a></div><div class="block-box" data-v-a0166b3a><div class="block" data-v-a0166b3a></div><div class="block next" data-v-a0166b3a></div><div class="block" data-v-a0166b3a></div><div class="block next" data-v-a0166b3a></div></div></div>',1)),l("div",{class:H(`text-track ${v(m)}`)},y(v(m)),3)])):U("",!0)}},ka=O(ga,[["__scopeId","data-v-a0166b3a"]]),pa={class:"da-vinci-cdoe"},Ca={class:"left-section"},Ma={class:"middle-section"},Sa=["width","height"],wa={class:"detail"},Ba={class:"your-time"},Ra={class:"right-section"},Va={class:"score-box"},Ea={class:"score best"},Ta={class:"score best"},Da={__name:"DaVinciCdoe",setup(h){const{daVinciCdoeAnimate:f,canvasSize:g,canvasRef:c,guessTime:m,playerName:M,bestScroe:x,tips:p,reset:C}=xa();return(R,o)=>{const S=ua("v-card");return N(),A("div",pa,[l("div",Ca,[D(S,{class:"score-box-card"},{default:F(()=>o[1]||(o[1]=[l("div",{class:"score-box"},[l("div",{class:"score best"},"1. "+y("qweqwe")),l("div",{class:"score best"},"2. "+y("ggdd")),l("div",{class:"score best"},"3. "+y("ccxxcvb"))],-1)])),_:1})]),l("div",Ma,[l("h1",{onClick:o[0]||(o[0]=(...V)=>v(C)&&v(C)(...V)),class:"restart"},"RESTART"),l("div",null,[l("canvas",{width:v(g),height:v(g),ref_key:"canvasRef",ref:c,class:"canv"},null,8,Sa)]),l("div",wa,[l("span",Ba,y(v(M))+": "+y(v(m)),1),v(p)?(N(),A("div",{key:0,class:H(`tips ${v(m)>5?"danger":""}`)},y(v(p)),3)):U("",!0)])]),l("div",Ra,[D(S,{class:"score-box-card"},{default:F(()=>[l("div",Va,[l("div",Ea,"BEST SCORE: "+y(v(x).guess_time||"???"),1),l("div",Ta,"BEST SCORE ID: "+y(v(x).name||"???"),1)])]),_:1})]),D(ka,{ref_key:"daVinciCdoeAnimate",ref:f},null,512)])}}},Ia=O(Da,[["__scopeId","data-v-e9829037"]]);export{Ia as default};
