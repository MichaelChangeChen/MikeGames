import{r as Z,g as aa}from"./getApi-D439t6d5.js";import{r as x,e as ta,f as sa,_ as Y,c as S,g as z,d as r,o as T,h as ea,b as p,t as A,n as G,i as ia}from"./index-CsY9p7NK.js";const na=()=>{const u=x(500),l=x(null),m=x(null),b=x(null),f=x(null),k=15,n=u.value/2,B=.3,_=.98,g=.9;let w=null,v=null,R=0,E=0,D=0,o=[];class U{constructor(a,s,e,i){this.x=a,this.y=s,this.vx=0,this.vy=0,this.radius=e,this.color=`hsl(${(Math.random()-1)*Math.random()*360}, 75%, 70%)`,this.id=i}draw(a){a.beginPath(),a.arc(this.x,this.y,this.radius,0,Math.PI*2),a.fillStyle=this.color,a.fill(),a.fillStyle="white",a.font="12px serif",a.textAlign="center",a.textBaseline="middle",a.fillText(this.id,this.x,this.y)}update(){if(this.id===(v==null?void 0:v.id))return this.vy=0;this.vy+=B,this.vy*=_,this.x+=this.vx,this.y+=this.vy,Math.abs(this.vx)<.01&&(this.vx=0),Math.abs(this.vy)<.01&&(this.vy=0)}resolveBoundary(){const a=this.x-n,s=this.y-n,e=Math.sqrt(a*a+s*s),i=n-this.radius;if(e>i){const d=Math.atan2(s,a);this.x=n+i*Math.cos(d),this.y=n+i*Math.sin(d);const c=a/e,h=s/e,y=this.vx*c+this.vy*h;this.vx-=2*y*c*g,this.vy-=2*y*h*g}}resolveCollision(a){const s=a.x-this.x,e=a.y-this.y,i=Math.hypot(s,e),d=this.radius+a.radius;if(i<d&&i>0){const c=s/i,h=e/i,y=d-i;this.x-=c*y*.5,this.y-=h*y*.5,a.x+=c*y*.5,a.y+=h*y*.5;const M=-h,C=c,N=this.vx*M+this.vy*C,q=a.vx*M+a.vy*C,$=this.vx*c+this.vy*h,L=a.vx*c+a.vy*h;this.vx=M*N+c*L,this.vy=C*N+h*L,a.vx=M*q+c*$,a.vy=C*q+h*$}}}const I=()=>{Z().then(t=>{t.data.statusCode===1?(D=t.data.max_num,m.value=t.data.guess_time,f.value=t.data.tips,b.value.check(t.data.message),F()):console.log("連線出現問題~")}).catch(t=>{console.log(t)})},X=async t=>{aa({guess:t}).then(a=>{a.data.statusCode===1?(a.data.status==="safe"&&(o=o.filter(s=>s.id<a.data.max_num&&a.data.min_num<s.id)),a.data.status==="boom"&&(o=[]),b.value.check(a.data.message),f.value=a.data.tips,m.value=a.data.guess_time):console.log("連線出現問題~")}).catch(a=>{console.log(a)})},F=async()=>{o=[];for(let t=0;t<D;t++)await H(t),await j(15)},j=t=>new Promise(a=>setTimeout(a,t)),H=t=>{const a=Math.random()*Math.PI+Math.PI,s=(Math.random()*.3+.4)*(n-k),e=n+Math.cos(a)*s,i=n+Math.sin(a)*s;o.push(new U(e,i,k,t+1))},P=()=>{const t=l.value;if(!t)return;const a=t.getContext("2d");a.clearRect(0,0,t.width,t.height),a.beginPath(),a.arc(n,n,n-1,0,Math.PI*2),a.strokeStyle="#999",a.stroke(),a.fillStyle="white",a.fill(),o.forEach(s=>s.update());for(let s=0;s<12;s++)for(let e=0;e<o.length;e++){for(let i=e+1;i<o.length;i++)o[e].resolveCollision(o[i]);o[e].resolveBoundary()}o.forEach(s=>s.draw(a)),w=requestAnimationFrame(P)},O=t=>{X(t)},V=t=>{const a=l.value.getBoundingClientRect();return{x:t.clientX-a.left,y:t.clientY-a.top}},J=t=>{const{x:a,y:s}=V(t);let e=!1;for(const i of o){const d=a-i.x,c=s-i.y;if(Math.sqrt(d*d+c*c)<=i.radius){e=!0;break}}l.value.style.cursor=v?"grabbing":e?"pointer":"default",v&&(v.x=a-R,v.y=s-E,v.vx=0,v.vy=0)},K=t=>{const{x:a,y:s}=V(t);for(const e of o){const i=a-e.x,d=s-e.y;if(Math.sqrt(i*i+d*d)<=e.radius){R=i,E=d,v=e;break}}},Q=t=>{v&&(v=null)},W=t=>{const{x:a,y:s}=V(t);for(const e of o){const i=a-e.x,d=s-e.y;if(Math.sqrt(i*i+d*d)<=e.radius){O(e.id);break}}};return ta(()=>{P(),I(),l.value.addEventListener("mousemove",J),l.value.addEventListener("mousedown",K),l.value.addEventListener("mouseup",Q),l.value.addEventListener("dblclick",W)}),sa(()=>{w&&cancelAnimationFrame(w)}),{daVinciCdoeAnimate:b,canvasSize:u,canvasRef:l,guessTime:m,tips:f,reset:I}},la=()=>{const u=x(!1),l=x(null);return{open:u,check:b=>{l.value=b,u.value=!u.value,setTimeout(()=>{u.value=!u.value,l.value=null},1800)},message:l}},oa={key:0,class:"da-vinci-cdoe-animate"},da={__name:"DaVinciCdoeAnimate",setup(u,{expose:l}){const{open:m,check:b,message:f}=la();return l({check:b}),(k,n)=>r(m)?(T(),S("div",oa,[n[0]||(n[0]=ea('<div class="block-track" data-v-a0166b3a><div class="block-box" data-v-a0166b3a><div class="block" data-v-a0166b3a></div><div class="block next" data-v-a0166b3a></div><div class="block" data-v-a0166b3a></div><div class="block next" data-v-a0166b3a></div></div><div class="block" data-v-a0166b3a></div><div class="block next" data-v-a0166b3a></div><div class="block-box" data-v-a0166b3a><div class="block" data-v-a0166b3a></div><div class="block next" data-v-a0166b3a></div><div class="block" data-v-a0166b3a></div><div class="block next" data-v-a0166b3a></div></div><div class="block" data-v-a0166b3a></div><div class="block next" data-v-a0166b3a></div><div class="block-box" data-v-a0166b3a><div class="block" data-v-a0166b3a></div><div class="block next" data-v-a0166b3a></div><div class="block" data-v-a0166b3a></div><div class="block next" data-v-a0166b3a></div></div></div>',1)),p("div",{class:G(`text-track ${r(f)}`)},A(r(f)),3)])):z("",!0)}},ca=Y(da,[["__scopeId","data-v-a0166b3a"]]),va={class:"da-vinci-cdoe"},ra=["width","height"],ua={class:"detail"},ha={class:"your-time"},ma={__name:"DaVinciCdoe",setup(u){const{daVinciCdoeAnimate:l,canvasSize:m,canvasRef:b,guessTime:f,tips:k,reset:n}=na();return(B,_)=>(T(),S("div",va,[p("h1",{onClick:_[0]||(_[0]=(...g)=>r(n)&&r(n)(...g)),class:"restart"},"RESTART"),p("div",null,[p("canvas",{width:r(m),height:r(m),ref_key:"canvasRef",ref:b,class:"canv"},null,8,ra)]),p("div",ua,[p("span",ha,"YOUR TIMES: "+A(r(f)),1),r(k)?(T(),S("div",{key:0,class:G(`tips ${r(f)>5?"danger":""}`)},A(r(k)),3)):z("",!0)]),ia(ca,{ref_key:"daVinciCdoeAnimate",ref:l},null,512)]))}},ya=Y(ma,[["__scopeId","data-v-6122f99d"]]);export{ya as default};
